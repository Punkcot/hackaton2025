<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Æ–¢—ç–π—Ä - –ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #mapContainer { width: 100%; height: 500px; border: 1px solid #ccc; margin: 20px 0; }
        .status { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –Æ–¢—ç–π—Ä - –ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤</h1>
    
    <div id="status" class="status info">
        ‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
    </div>
    
    <div id="mapContainer"></div>
    
    <div id="stats" style="display: none;">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
        <ul>
            <li>–ì–æ—Ä–æ–¥–æ–≤: <span id="cityCount">0</span></li>
            <li>–ú–∞—Ä—à—Ä—É—Ç–æ–≤: <span id="routeCount">0</span></li>
            <li>–†–µ–π—Å–æ–≤: <span id="flightCount">0</span></li>
        </ul>
    </div>

    <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API -->
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    
    <!-- –î–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Æ–¢—ç–π—Ä -->
    <script src="src/js/utair-data.js"></script>
    
    <script>
        const statusDiv = document.getElementById('status');
        const statsDiv = document.getElementById('stats');
        
        function updateStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            console.log(message);
        }
        
        function updateStats(cities, routes, flights) {
            document.getElementById('cityCount').textContent = cities;
            document.getElementById('routeCount').textContent = routes;
            document.getElementById('flightCount').textContent = flights;
            statsDiv.style.display = 'block';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
        if (typeof UTAIR_DATA === 'undefined') {
            updateStatus('‚ùå –î–∞–Ω–Ω—ã–µ –Æ–¢—ç–π—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'error');
        } else {
            updateStatus(`‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${Object.keys(UTAIR_DATA.cities).length} –≥–æ—Ä–æ–¥–æ–≤, ${UTAIR_DATA.routes.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤`, 'success');
            
            const totalFlights = UTAIR_DATA.routes.reduce((sum, route) => sum + route.flights, 0);
            updateStats(Object.keys(UTAIR_DATA.cities).length, UTAIR_DATA.routes.length, totalFlights);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
        ymaps.ready(function() {
            updateStatus('üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            
            try {
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
                const yandexMap = new ymaps.Map('mapContainer', {
                    center: [58.0, 65.0],
                    zoom: 5,
                    controls: ['zoomControl', 'typeSelector']
                });
                
                updateStatus('‚úÖ –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –≥–æ—Ä–æ–¥–æ–≤
                if (typeof UTAIR_DATA !== 'undefined') {
                    const features = [];
                    
                    Object.entries(UTAIR_DATA.cities).forEach(([code, city], index) => {
                        features.push({
                            type: 'Feature',
                            id: index,
                            geometry: {
                                type: 'Point',
                                coordinates: city.coords
                            },
                            properties: {
                                balloonContentHeader: city.name,
                                balloonContentBody: `–ö–æ–¥: ${code}`,
                                hintContent: city.name,
                                iconContent: '‚úàÔ∏è'
                            },
                            options: {
                                preset: 'islands#blueIcon'
                            }
                        });
                    });
                    
                    const objectManager = new ymaps.ObjectManager();
                    objectManager.add({
                        type: 'FeatureCollection',
                        features: features
                    });
                    yandexMap.geoObjects.add(objectManager);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã
                    UTAIR_DATA.routes.slice(0, 10).forEach(route => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 –¥–ª—è —Ç–µ—Å—Ç–∞
                        const routeLine = new ymaps.Polyline([
                            route.from,
                            route.to
                        ], {
                            balloonContentHeader: route.name,
                            balloonContentBody: `–†–µ–π—Å–æ–≤: ${route.flights}`,
                            hintContent: route.name
                        }, {
                            strokeColor: '#0066CC',
                            strokeWidth: 3,
                            strokeOpacity: 0.7
                        });
                        
                        yandexMap.geoObjects.add(routeLine);
                    });
                    
                    updateStatus(`üéØ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ ${features.length} –≥–æ—Ä–æ–¥–æ–≤ –∏ ${Math.min(10, UTAIR_DATA.routes.length)} –º–∞—Ä—à—Ä—É—Ç–æ–≤`, 'success');
                } else {
                    updateStatus('‚ö†Ô∏è –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                }
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        });
    </script>
</body>
</html>


