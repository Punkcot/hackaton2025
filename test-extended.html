<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç –Æ–¢—ç–π—Ä - –ü–æ–ª–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–Ω–∞—è —Å–µ—Ç—å</title>
    <style>
        body { font-family: Inter, Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,102,204,0.1); }
        h1 { color: #0066CC; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        #mapContainer { width: 100%; height: 600px; border: 2px solid #0066CC; margin: 20px 0; border-radius: 10px; }
        .status { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: 500; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #0066CC, #3399FF); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { opacity: 0.9; }
        .controls { text-align: center; margin: 20px 0; }
        .btn { background: #0066CC; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin: 0 10px; cursor: pointer; font-weight: 500; }
        .btn:hover { background: #004499; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç –Æ–¢—ç–π—Ä - –ü–æ–ª–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–Ω–∞—è —Å–µ—Ç—å</h1>
        <p class="subtitle">–í—Å–µ –≥–æ—Ä–æ–¥–∞ –∏ –º–∞—Ä—à—Ä—É—Ç—ã —Å –ø–ª–∞–≤–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏</p>
        
        <div id="status" class="status info">
            ‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π —Å–µ—Ç–∏...
        </div>
        
        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="cityCount">0</div>
                <div class="stat-label">–ì–æ—Ä–æ–¥–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="routeCount">0</div>
                <div class="stat-label">–ú–∞—Ä—à—Ä—É—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="flightCount">0</div>
                <div class="stat-label">–†–µ–π—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="showAllRoutes()">üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã</button>
            <button class="btn" onclick="resetView()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥</button>
            <button class="btn" onclick="toggleRoutes()">üëÅÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>
        </div>
        
        <div id="mapContainer"></div>
    </div>

    <!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API -->
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    
    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Æ–¢—ç–π—Ä -->
    <script src="src/js/utair-data-extended.js"></script>
    
    <script>
        const statusDiv = document.getElementById('status');
        const statsDiv = document.getElementById('stats');
        let yandexMap;
        let routeLines = [];
        let objectManager;
        let routesVisible = true;
        
        function updateStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            console.log(message);
        }
        
        function updateStats(cities, routes, flights) {
            document.getElementById('cityCount').textContent = cities;
            document.getElementById('routeCount').textContent = routes;
            document.getElementById('flightCount').textContent = flights.toLocaleString();
            statsDiv.style.display = 'grid';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
        if (typeof UTAIR_DATA_EXTENDED === 'undefined') {
            updateStatus('‚ùå –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Æ–¢—ç–π—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'error');
        } else {
            updateStatus(`‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${Object.keys(UTAIR_DATA_EXTENDED.cities).length} –≥–æ—Ä–æ–¥–æ–≤, ${UTAIR_DATA_EXTENDED.routes.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤`, 'success');
            
            const totalFlights = UTAIR_DATA_EXTENDED.routes.reduce((sum, route) => sum + route.flights, 0);
            updateStats(Object.keys(UTAIR_DATA_EXTENDED.cities).length, UTAIR_DATA_EXTENDED.routes.length, totalFlights);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
        ymaps.ready(function() {
            updateStatus('üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
            
            try {
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
                yandexMap = new ymaps.Map('mapContainer', {
                    center: [55.0, 65.0],
                    zoom: 4,
                    controls: ['zoomControl', 'typeSelector', 'fullscreenControl']
                });
                
                updateStatus('‚úÖ –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –≥–æ—Ä–æ–¥–æ–≤
                if (typeof UTAIR_DATA_EXTENDED !== 'undefined') {
                    const features = [];
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞–±—ã
                    const mainHubs = UTAIR_DATA_EXTENDED.stats.main_hubs || ['–ú–û–í', '–°–£–†', '–¢–Æ–ú'];
                    
                    Object.entries(UTAIR_DATA_EXTENDED.cities).forEach(([code, city], index) => {
                        const isHub = mainHubs.includes(code);
                        
                        features.push({
                            type: 'Feature',
                            id: index,
                            geometry: {
                                type: 'Point',
                                coordinates: city.coords
                            },
                            properties: {
                                balloonContentHeader: city.name,
                                balloonContentBody: `<strong>${isHub ? '–û—Å–Ω–æ–≤–Ω–æ–π —Ö–∞–±' : '–ê—ç—Ä–æ–ø–æ—Ä—Ç'} –Æ–¢—ç–π—Ä</strong><br>–ö–æ–¥: ${code}`,
                                hintContent: city.name,
                                iconContent: isHub ? 'üè¢' : '‚úàÔ∏è'
                            },
                            options: {
                                preset: 'islands#blueIcon',
                                iconColor: isHub ? '#004499' : '#0066CC'
                            }
                        });
                    });
                    
                    objectManager = new ymaps.ObjectManager({
                        clusterize: true,
                        gridSize: 64
                    });
                    objectManager.add({
                        type: 'FeatureCollection',
                        features: features
                    });
                    yandexMap.geoObjects.add(objectManager);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç–æ–ª—å–∫–æ —Ç–æ–ø-50 –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
                    const topRoutes = UTAIR_DATA_EXTENDED.routes
                        .sort((a, b) => b.flights - a.flights)
                        .slice(0, 50);
                    
                    topRoutes.forEach((route, index) => {
                        const weight = Math.min(2 + Math.log(route.flights), 6);
                        const opacity = Math.min(0.6 + route.flights / 100, 0.8);
                        const color = route.flights > 30 ? '#004499' : 
                                     route.flights > 15 ? '#0066CC' : '#3399FF';
                        
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–ª–∞–≤–Ω—ã–π –ø—É—Ç—å, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                        let pathCoords;
                        if (route.path && route.path.length > 2) {
                            pathCoords = route.path;
                        } else {
                            pathCoords = [route.from, route.to];
                        }
                        
                        const routeLine = new ymaps.Polyline(pathCoords, {
                            balloonContentHeader: route.name,
                            balloonContentBody: `<strong>–†–µ–π—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é: ${route.flights}</strong><br>–ö–æ–¥: ${route.code}`,
                            hintContent: route.name
                        }, {
                            strokeColor: color,
                            strokeWidth: weight,
                            strokeOpacity: opacity,
                            strokeStyle: route.flights > 20 ? 'solid' : 'dash'
                        });
                        
                        yandexMap.geoObjects.add(routeLine);
                        routeLines.push(routeLine);
                    });
                    
                    updateStatus(`üéØ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ ${features.length} –≥–æ—Ä–æ–¥–æ–≤ –∏ ${topRoutes.length} –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤`, 'success');
                } else {
                    updateStatus('‚ö†Ô∏è –ö–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                }
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        });
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function showAllRoutes() {
            if (yandexMap && yandexMap.geoObjects) {
                yandexMap.setBounds(yandexMap.geoObjects.getBounds(), {
                    checkZoomRange: true,
                    zoomMargin: 50
                });
            }
        }
        
        function resetView() {
            if (yandexMap) {
                yandexMap.setCenter([55.0, 65.0], 4);
            }
        }
        
        function toggleRoutes() {
            routeLines.forEach(line => {
                if (routesVisible) {
                    yandexMap.geoObjects.remove(line);
                } else {
                    yandexMap.geoObjects.add(line);
                }
            });
            routesVisible = !routesVisible;
            updateStatus(routesVisible ? 'üëÅÔ∏è –ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ–∫–∞–∑–∞–Ω—ã' : 'üôà –ú–∞—Ä—à—Ä—É—Ç—ã —Å–∫—Ä—ã—Ç—ã', 'info');
        }
    </script>
</body>
</html>


